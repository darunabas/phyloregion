<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Endemism patterns are scale dependent • phyloregion</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Endemism patterns are scale dependent">
<meta property="og:description" content="phyloregion">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phyloregion</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Benchmark.html">Benchmarking phyloregion</a>
    </li>
    <li>
      <a href="../articles/ed.html">Fast Evolutionary Distinctiveness in R</a>
    </li>
    <li>
      <a href="../articles/heterogeneity.html">Endemism patterns are scale dependent</a>
    </li>
    <li>
      <a href="../articles/pd.html">Phylogenetic Diversity for Large Datasets</a>
    </li>
    <li>
      <a href="../articles/phyloregion-intro.html">An introduction to the phyloregion package</a>
    </li>
    <li>
      <a href="../articles/scalability.html">Scalability of phyloregion</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/darunabas/phyloregion/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="heterogeneity_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="heterogeneity_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="heterogeneity_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Endemism patterns are scale dependent</h1>
                        <h4 class="author">Barnabas H. Daru, Harith Farooq, Alexandre Antonelli &amp; Søren Faurby</h4>
            
            <h4 class="date">March 23, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/darunabas/phyloregion/blob/master/vignettes/heterogeneity.Rmd"><code>vignettes/heterogeneity.Rmd</code></a></small>
      <div class="hidden name"><code>heterogeneity.Rmd</code></div>

    </div>

    
    
<div id="environmental-data-and-heterogeneity" class="section level2">
<h2 class="hasAnchor">
<a href="#environmental-data-and-heterogeneity" class="anchor"></a>1. Environmental data and heterogeneity</h2>
<p>We selected key environmental factors that are commonly used to examine biodiversity-environment associations. These variables included mean annual temperature, mean annual precipitation, annual net primary productivity and elevation. Mean annual temperature, mean annual precipitation and elevation were downloaded as raster layers from the WorldClim database<span class="citation"><sup>1</sup></span> at a resolution of 2.5’. Annual net primary productivity was downloaded from NASA Moderate Resolution Imaging Spectroradiometer (MODIS) at a resolution of 1 km and calculated using the MOD17 algorithm. These variables were converted to Behrmann equal-area projection using the function <code>projectRaster</code> in the <code>R</code> package <code>raster</code>.<span class="citation"><sup>2</sup></span></p>
<p>We defined ‘environmental heterogeneity’ as the variation of environmental factors in each cell, obtained by taking the standard deviation of the environmental variables (temperature, precipitation, elevation and productivity) in each cell and across grain sizes (50, 100, 200, 400 and 800 km). Henceforth, we refer to the standard deviation of these four environmental variables i.e., mean annual temperature, mean annual precipitation, annual net primary productivity and elevation, as temperature variation, precipitation variation, productivity variation and elevation variation, respectively.</p>
</div>
<div id="environmental-heterogeneity" class="section level2">
<h2 class="hasAnchor">
<a href="#environmental-heterogeneity" class="anchor"></a>2. Environmental heterogeneity</h2>
<p>To measure environmental heterogeneity, for each cell and across grain sizes (50, 100, 200, 400 and 800 km), we extracted the standard deviation of the four environmental variables (temperature, precipitation, elevation and productivity) using the function <code>extract_climate</code> in the R package <code>phyloregionExtras</code>:<span class="citation"><sup>3</sup></span></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract_climate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">val</span> <span class="op">=</span> <span class="st">"val"</span>, <span class="va">FUN</span> <span class="op">=</span> <span class="va">sd</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span><span class="va">x</span>, crs <span class="op">=</span> <span class="op">(</span><span class="st">'+proj=longlat'</span><span class="op">)</span><span class="op">)</span>
  <span class="va">ras</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span><span class="va">x</span>, crs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">proj4string</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, over <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="va">ras</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span>
  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">p</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="fu">FUN</span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="kw">else</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y</span><span class="op">$</span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="va">m</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/match.html">match</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">val</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="co">######### Arguments #######################</span>
<span class="co"># x: A raster file of the environmental variable</span>
<span class="co"># y: Spatial polygons corresponding to the study area to extract the variable.</span>
<span class="co"># val: String to rename the column with the extracted variable.</span>
<span class="co"># FUN: The function to summarize the values (e.g. sd, mean)</span></code></pre></div>
</div>
<div id="linear-mixed-effects-model" class="section level2">
<h2 class="hasAnchor">
<a href="#linear-mixed-effects-model" class="anchor"></a>3. Linear mixed-effects model</h2>
<p>We fit a single linear mixed-effects model to analyse the effect of environmental heterogeneity on patterns of endemism (PE or WE) across grain sizes. A linear mixed-effects model allows the modeling of data as a combination of fixed effects, random effects and independent random error, and are especially useful when there is non-independence in the data.<span class="citation"><sup>4</sup></span> The standard form of a linear mixed-effects model is expressed as: <span class="math display">\[Y_i = x_i\beta + s_i + Ɛ_i\]</span> where <span class="math inline">\(Y_i\)</span> represents the response variable at grid cell or location <span class="math inline">\(i\)</span>, <span class="math inline">\(x_i\)</span> is a vector containing spatially referenced nonrandom predictors, and <span class="math inline">\(\beta\)</span> is a vector of the fixed effect parameters, <span class="math inline">\(s_i\)</span> is a spatially correlated random effect and <span class="math inline">\(Ɛ_i\)</span> is the random measurement error. All explanatory variables were standardised prior to statistical analyses so that all variables had a standard deviation of 1 and a mean of 0. This ensures that the estimated coefficients are all on the same scale and for easier comparison of effect sizes.</p>
<p>The linear mixed-effects model was fit as a single model with all the variables in one model predicting endemism (PE or WE) as a function of the four environmental variables (temperature variation, precipitation variation, elevation variation and productivity variation), with continent identity of grid cells as a random effect, allowing us to include any idiosyncratic differences between continents. The model also includes a spatial covariate of geographical coordinates as an additional predictor variable to account for spatial autocorrelation. The spatial covariate was created as a matrix of the coordinates of each cell’s centroid corresponding to the geographical Cartesian <span class="math inline">\(x/y-\)</span> coordinates (longitude and latitude)and was calculated with the function <code>autocov_dist</code> in the <code>R</code> package <code>spdep</code>.<span class="citation"><sup>5</sup></span> For each focal cell, we varied the weighting function and neighbourhood sizes using the next one to two cell neighbours to remove spatial autocorrelation (function <code>nb2listw</code> in spdep<span class="citation"><sup>5</sup></span>). We used the maximum likelihood optimization criterion over restricted maximum likelihood, to allow significance testing via model comparison.</p>
<p>The linear mixed-effects model was fit in <code>R</code> v.3.6.3 with the <code>lme</code> function in the R package <code>nlme</code><span class="citation"><sup>6</sup></span>. The variations of environmental variables on endemism are presented as estimated coefficients of the fixed effects and their 95% confidence intervals in the <code>R</code> package <code>nlme</code><span class="citation"><sup>6</sup></span>.</p>
<p>In order to illustrate the process we have added all codes below for the analyses:</p>
<p>First, load the packages for the analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Function for computing environmental heterogeneity</span>
<span class="va">clim_heterogeneity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span> <span class="op">=</span><span class="st">"y"</span>, <span class="va">nbs</span> <span class="op">=</span> <span class="fl">2000000</span>,
                          <span class="va">x1</span> <span class="op">=</span> <span class="st">"x1"</span>, <span class="va">x2</span> <span class="op">=</span> <span class="st">"x2"</span>, <span class="va">x3</span> <span class="op">=</span> <span class="st">"x3"</span>, <span class="va">x4</span> <span class="op">=</span> <span class="st">"x4"</span>,
                          <span class="va">lon</span><span class="op">=</span><span class="st">"lon"</span>, <span class="va">lat</span><span class="op">=</span><span class="st">"lat"</span>, <span class="va">continent</span> <span class="op">=</span> <span class="st">"continent"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,<span class="op">]</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="va">x4</span>, <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">continent</span><span class="op">)</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span>, <span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"continent"</span><span class="op">)</span>
  
  <span class="va">x</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">y</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">x</span><span class="op">$</span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">x1</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">x</span><span class="op">$</span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">x2</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">x</span><span class="op">$</span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">x3</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">x</span><span class="op">$</span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">x4</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

  <span class="co"># 1. Autocovariate regression: make a matrix of coordinates</span>
  <span class="va">coords.mtrx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

  <span class="co"># 2. Compute the autocovariate based on distance and weight above</span>
  <span class="va">x</span><span class="op">$</span><span class="va">ac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spdep/man/autocov_dist.html">autocov_dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">coords.mtrx</span>, nbs <span class="op">=</span> <span class="va">nbs</span>,
                     type <span class="op">=</span> <span class="st">"inverse.squared"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

  <span class="co"># 3. LME with autocovariate as additional predictor &amp; continent as random effects</span>
  <span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">ac</span>, random <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">|</span><span class="va">continent</span>, data <span class="op">=</span> <span class="va">x</span>, method<span class="op">=</span><span class="st">"ML"</span><span class="op">)</span>

  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/intervals.html">intervals</a></span><span class="op">(</span><span class="va">mod1</span>, which <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span><span class="op">$</span><span class="va">fixed</span><span class="op">)</span>
  <span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/anova.lme.html">anova.lme</a></span><span class="op">(</span><span class="va">mod1</span>, type <span class="op">=</span> <span class="st">"marginal"</span><span class="op">)</span><span class="op">$</span><span class="st">'p-value'</span>

  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span>, p_val <span class="op">=</span> <span class="va">fm</span><span class="op">)</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(Intercept)"</span>, <span class="st">"ac"</span><span class="op">)</span>, <span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="va">x4</span><span class="op">)</span>

  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>clim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, <span class="va">res</span>, row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>


<span class="co">######### Arguments #######################</span>
<span class="co"># x: A data.frame</span>
<span class="co"># y: A response variable</span>
<span class="co"># nbs: Neighbourhood distance</span>
<span class="co"># x1..x4 An explanatory variables corresponding to environmental variables</span>
<span class="co"># lon: Column name of the longitude.</span>
<span class="co"># lat: Column name of the latitude.</span>
<span class="co"># continent: Column name of the column containing continent identity for grid cells</span>

<span class="va">fun1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"\\/"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"\\_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".csv"</span>, <span class="st">""</span>, <span class="va">res</span><span class="op">)</span>
    <span class="va">res</span>
<span class="op">}</span>


<span class="co"># Download the data frames from Dropbox and save in temporary folder</span>
<span class="va">dir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://github.com/darunabas/extras/archive/master.zip"</span>,
              destfile <span class="op">=</span> <span class="st">"extras-master.zip"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="st">"extras-master.zip"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"extras-master"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ENVIRONMENT" "mergedSA"    "shapefile"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'ENVIRONMENT/birds/WE'</span>, pattern<span class="op">=</span><span class="st">"*.csv"</span>, full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'ENVIRONMENT/birds/PE'</span>, pattern<span class="op">=</span><span class="st">"*.csv"</span>, full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'ENVIRONMENT/amphibians/WE'</span>, pattern<span class="op">=</span><span class="st">"*.csv"</span>, full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'ENVIRONMENT/amphibians/PE'</span>, pattern<span class="op">=</span><span class="st">"*.csv"</span>, full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">fun1</span><span class="op">)</span><span class="op">)</span>
<span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">fun1</span><span class="op">)</span><span class="op">)</span>
<span class="va">f3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t3</span>, <span class="va">fun1</span><span class="op">)</span><span class="op">)</span>
<span class="va">f4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t4</span>, <span class="va">fun1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># load the data frames for each grain size</span>
<span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">x</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">x</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">x</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">d4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">t4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">x</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">d1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##    grids        WE    sd_ALT    sd_MAP   sd_MAT       sd_NPP      lon      lat
## 1 v10084  340.2460  562.8624   71.9370 3.848896  15284319418 -7052646 -1737713
## 2 v10088  606.7684  404.9584   50.2280 2.356266  32349944611 -6852646 -1737713
## 3 v10089 1143.1800  767.3688  395.3724 3.936351  18044787059 -6802646 -1737713
## 4 v10090 1437.5099 1187.8156 1062.3708 5.590839  63536778570 -6752646 -1737713
## 5 v10091 1488.2875  348.5838  380.4115 1.503277 203536278064 -6702646 -1737713
## 6 v10092  867.2580  398.0916  191.2684 1.678670   3244896302 -6652646 -1737713</code></pre>
</div>
<div id="visualisation-of-results" class="section level2">
<h2 class="hasAnchor">
<a href="#visualisation-of-results" class="anchor"></a>4. Visualisation of results</h2>
<div id="environmental-heterogeneity-and-bird-weighted-endemism" class="section level3">
<h3 class="hasAnchor">
<a href="#environmental-heterogeneity-and-bird-weighted-endemism" class="anchor"></a>4.1. Environmental heterogeneity and bird weighted endemism</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">d1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">clim_heterogeneity</span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="st">"WE"</span>, x1 <span class="op">=</span> <span class="st">"sd_ALT"</span>,
                                                 x2 <span class="op">=</span> <span class="st">"sd_MAP"</span>, x3 <span class="op">=</span> <span class="st">"sd_MAT"</span>,
                                                 x4 <span class="op">=</span> <span class="st">"sd_NPP"</span>, nbs <span class="op">=</span> <span class="fl">2000000</span><span class="op">)</span><span class="op">)</span>
<span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">spo</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>
<span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">spo</span><span class="op">)</span>, scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">ll</span><span class="op">)</span><span class="op">)</span>

<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">z1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">scale</span>, y<span class="op">=</span><span class="va">est.</span>, group<span class="op">=</span><span class="va">clim</span>, color<span class="op">=</span><span class="va">clim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">upper</span>, ymin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>,
                  size  <span class="op">=</span> <span class="fl">.4</span>,
                  width <span class="op">=</span> <span class="fl">.15</span>,
                  position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#1b9e77'</span>,<span class="st">'#d95f02'</span>, <span class="st">"#7570b3"</span>, <span class="st">"#e7298a"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Estimated effects"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="bird_WE.png" alt=""><p class="caption">Plot of environmental heterogeneity on bird weighted endemism</p>
</div>
</div>
<div id="environmental-heterogeneity-and-bird-phylogenetic-endemism" class="section level3">
<h3 class="hasAnchor">
<a href="#environmental-heterogeneity-and-bird-phylogenetic-endemism" class="anchor"></a>4.2. Environmental heterogeneity and bird phylogenetic endemism</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">d2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">clim_heterogeneity</span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="st">"PE"</span>, x1 <span class="op">=</span> <span class="st">"sd_ALT"</span>,
                                                 x2 <span class="op">=</span> <span class="st">"sd_MAP"</span>, x3 <span class="op">=</span> <span class="st">"sd_MAT"</span>,
                                                 x4 <span class="op">=</span> <span class="st">"sd_NPP"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">spo</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>
<span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">spo</span><span class="op">)</span>, scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">f2</span>, <span class="va">ll</span><span class="op">)</span><span class="op">)</span>

<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">z1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">scale</span>, y<span class="op">=</span><span class="va">est.</span>, group<span class="op">=</span><span class="va">clim</span>, color<span class="op">=</span><span class="va">clim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">upper</span>, ymin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>,
                  size  <span class="op">=</span> <span class="fl">.4</span>,
                  width <span class="op">=</span> <span class="fl">.15</span>,
                  position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#1b9e77'</span>,<span class="st">'#d95f02'</span>, <span class="st">"#7570b3"</span>, <span class="st">"#e7298a"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Estimates of fixed effects"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="bird_PE.png" alt=""><p class="caption">Plot of environmental heterogeneity on bird phylogenetic endemism</p>
</div>
</div>
<div id="environmental-heterogeneity-and-amphibian-weighted-endemism" class="section level3">
<h3 class="hasAnchor">
<a href="#environmental-heterogeneity-and-amphibian-weighted-endemism" class="anchor"></a>4.3. Environmental heterogeneity and amphibian weighted endemism</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">d3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">clim_heterogeneity</span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="st">"WE"</span>, x1 <span class="op">=</span> <span class="st">"sd_ALT"</span>,
                                                 x2 <span class="op">=</span> <span class="st">"sd_MAP"</span>, x3 <span class="op">=</span> <span class="st">"sd_MAT"</span>,
                                                 x4 <span class="op">=</span> <span class="st">"sd_NPP"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">spo</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>
<span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">spo</span><span class="op">)</span>, scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">f3</span>, <span class="va">ll</span><span class="op">)</span><span class="op">)</span>

<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">z1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">scale</span>, y<span class="op">=</span><span class="va">est.</span>, group<span class="op">=</span><span class="va">clim</span>, color<span class="op">=</span><span class="va">clim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">upper</span>, ymin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>,
                  size  <span class="op">=</span> <span class="fl">.4</span>,
                  width <span class="op">=</span> <span class="fl">.15</span>,
                  position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#1b9e77'</span>,<span class="st">'#d95f02'</span>, <span class="st">"#7570b3"</span>, <span class="st">"#e7298a"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Estimates of fixed effects"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="amphibian_WE.png" alt=""><p class="caption">Plot of environmental heterogeneity on amphibian weighted endemism</p>
</div>
</div>
<div id="environmental-heterogeneity-and-amphibian-phylogenetic-endemism" class="section level3">
<h3 class="hasAnchor">
<a href="#environmental-heterogeneity-and-amphibian-phylogenetic-endemism" class="anchor"></a>4.4. Environmental heterogeneity and amphibian phylogenetic endemism</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">d4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">clim_heterogeneity</span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="st">"PE"</span>, x1 <span class="op">=</span> <span class="st">"sd_ALT"</span>,
                                                 x2 <span class="op">=</span> <span class="st">"sd_MAP"</span>, x3 <span class="op">=</span> <span class="st">"sd_MAT"</span>,
                                                 x4 <span class="op">=</span> <span class="st">"sd_NPP"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">spo</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>
<span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">spo</span><span class="op">)</span>, scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">f4</span>, <span class="va">ll</span><span class="op">)</span><span class="op">)</span>

<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">z1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">scale</span>, y<span class="op">=</span><span class="va">est.</span>, group<span class="op">=</span><span class="va">clim</span>, color<span class="op">=</span><span class="va">clim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">upper</span>, ymin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>,
                  size  <span class="op">=</span> <span class="fl">.4</span>,
                  width <span class="op">=</span> <span class="fl">.15</span>,
                  position <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#1b9e77'</span>,<span class="st">'#d95f02'</span>, <span class="st">"#7570b3"</span>, <span class="st">"#e7298a"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Estimates of fixed effects"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="amphibian_PE.png" alt=""><p class="caption">Plot of environmental heterogeneity on amphibian phylogenetic endemism</p>
</div>
</div>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session Information</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 3.6.1 (2019-07-05)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Mojave 10.14.6
## 
## Matrix products: default
## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] nlme_3.1-145  ggplot2_3.3.0 spdep_1.1-3   sf_0.8-1      spData_0.3.3  sp_1.4-1     
## [7] knitr_1.28   
## 
## loaded via a namespace (and not attached):
##  [1] gtools_3.8.1       tidyselect_1.0.0   xfun_0.12          purrr_0.3.3       
##  [5] splines_3.6.1      lattice_0.20-40    colorspace_1.4-1   expm_0.999-4      
##  [9] htmltools_0.4.0    yaml_2.2.1         rlang_0.4.5        e1071_1.7-3       
## [13] pillar_1.4.3       glue_1.3.2         withr_2.1.2        DBI_1.1.0         
## [17] lifecycle_0.2.0    stringr_1.4.0      munsell_0.5.0      gtable_0.3.0      
## [21] raster_3.0-12      codetools_0.2-16   coda_0.19-3        evaluate_0.14     
## [25] labeling_0.3       class_7.3-15       highr_0.8          Rcpp_1.0.3        
## [29] KernSmooth_2.23-16 scales_1.1.0       classInt_0.4-2     gdata_2.18.0      
## [33] farver_2.0.3       deldir_0.1-25      digest_0.6.25      stringi_1.4.6     
## [37] gmodels_2.18.1     dplyr_0.8.5        grid_3.6.1         tools_3.6.1       
## [41] LearnBayes_2.15.1  magrittr_1.5       tibble_2.1.3       crayon_1.3.4      
## [45] pkgconfig_2.0.3    MASS_7.3-51.5      Matrix_1.2-18      assertthat_0.2.1  
## [49] rmarkdown_2.1      R6_2.4.1           boot_1.3-24        units_0.6-5       
## [53] compiler_3.6.1</code></pre>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>REFERENCES</h2>
<div id="refs" class="references">
<div id="ref-Hijmans2005">
<p>1. Hijmans, R. J., Cameron, S. E., Parra, J. L., Jones, P. G. &amp; Jarvis, A. Very high resolution interpolated climate surfaces for global land areas. <em>International Journal of Climatology</em> <strong>25</strong>, 1965–1978 (2005).</p>
</div>
<div id="ref-raster">
<p>2. Hijmans, R. J. <em>Raster: Geographic data analysis and modeling</em>. (2020).</p>
</div>
<div id="ref-phyloregionExtras">
<p>3. Daru, B. H., Karunarathne, P. &amp; Schliep, K. <em>PhyloregionExtras: Extras for biogeographic regionalization and spatial conservation</em>. (2020).</p>
</div>
<div id="ref-verbeke2000">
<p>4. Verbeke, G. &amp; Molenberghs, G. Linear mixed models for longitudinal data. in <em>Linear mixed models in practice</em> 63–153 (Springer-Verlag, 2000).</p>
</div>
<div id="ref-spdep">
<p>5. Bivand, R. &amp; Wong, D. W. S. Comparing implementations of global and local indicators of spatial association. <em>TEST</em> <strong>27</strong>, 716–748 (2018).</p>
</div>
<div id="ref-nlme">
<p>6. Pinheiro, J., Bates, D., DebRoy, S., Sarkar, D. &amp; R Core Team. <em>nlme: Linear and nonlinear mixed effects models</em>. (2020).</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Barnabas H. Daru, Piyal Karunarathne, Klaus Schliep.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
